global

  {% if haproxy.logs is defined %}
  {% for log in haproxy.logs %}
  log {{ log }}
  {% endfor %}
  {% endif %}

  {% for key, value in haproxy.global %}
  {{ key }} {{ value }}
  {% endfor %}

defaults

  {% for key, value in haproxy.defaults %}
  {{ key }} {{ value }}
  {% endfor %}

  {% for key, value in haproxy.timeout %}
  {{ key }} {{ value }}
  {% endfor %}

  {% for frontend in haproxy.frontend %}
  frontend {{ frontend }}
  {% for key, value in frontend %}
    {{ key }} {{ value }}
  {% endfor %}
  {% endfor %}

  {% for backend in haproxy.backend %}
  backend {{ backend }}
  {% for key, value in backend %}
    {% if value is mapping %}
    {% for option in haproxy.backend[key] %}
    {{ key }} {{ option }}
    {% endfor %}
    {% else %}
    {{ key }} {{ value }}
    {% endif %}
  {% endfor %}
  {% endfor %}

{% for listener in haproxy.listen %}
  listen {{ listener }}
  {% for key, value in listener %}
  {% if value is mapping %}
  {% for property, attribute in value.items() %}
      {{ property }} {{ attribute }}
  {% endfor %}
  {% else %}
      {{ key }} {{ value }}
  {% endif %}
 {% endfor %}
{% endfor %}
